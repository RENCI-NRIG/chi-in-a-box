groups:
- name: openstack
  rules:

  - alert: OpenStackAPIDown
    expr: openstack_check_api == 0
    for: 10m
    labels:
      severity: critical
    annotations:
      summary: "OpenStack {{ $labels.service | title }} service is down"
      description: "The *{{ $labels.service | title }}* service on {{ $labels.hostname }} is not responding."
      runbook: https://github.com/ChameleonCloud/chi-in-a-box/wiki/%5BRunbook%5D-OpenStackAPIDown

  - alert: IronicNodeInErrorState
    expr: sum(openstack_ironic_nodes{provision_state="error",maintenance="false"}) by (hostname, name)
    for: 30m
    labels:
      severity: critical
    annotations:
      summary: "Ironic node in error provision state"
      description: "Ironic node {{ $labels.name }} on {{ $labels.hostname }} is in an error provision state."
      runbook: https://github.com/ChameleonCloud/chi-in-a-box/wiki/%5BRunbook%5D-IronicNodeInErrorState

  - alert: IronicNodeConsoleDisabled
    expr: sum(openstack_ironic_nodes{console_enabled="false",provision_state="active",maintenance="false"}) by (hostname, name)
    for: 1h
    labels:
      severity: warning
    annotations:
      summary: "Ironic node's serial console is disabled"
      description: "Node {{ $labels.name }} on {{ $labels.hostname }} does not have a serial console enabled."
      runbook: https://github.com/ChameleonCloud/chi-in-a-box/wiki/%5BRunbook%5D-IronicNodeConsoleDisabled

  - alert: IronicLowImageCacheSpace
    expr: |
      min(node_filesystem_avail_bytes{mountpoint=~"/var(/lib(/(docker|ironic))?)?"})
      by (hostname)
      <
      (1024 * 1024 * 1024 * 15)
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Low Ironic cache space on {{ $labels.hostname }}"
      description: "Ironic process on {{ $labels.hostname }} has less than 15GB of space to use for image cache."
      runbook: https://github.com/ChameleonCloud/chi-in-a-box/wiki/%5BRunbook%5D-IronicLowImageCacheSpace
